<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="styles/bootstrap-sketchy.min.css">
        <link rel="stylesheet" href="styles/custom.css">
        <title>Space Scales</title>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="space-scales.js"></script>
        <script src="real-data.js"></script>
        <script src="kerbal-data.js"></script>
        <script src="moon-data.js"></script>
    </head>
    <body id="root">
        <div id="buttons">
            <div id="sizebyGroup">
                <button id="radius" onclick="onSizeByChange('radius')" class="sizeby btn btn-primary">Radius</button>
                <button id="density" onclick="onSizeByChange('density')" class="sizeby btn btn-outline-primary">Density</button>
                <button id="mass" onclick="onSizeByChange('mass')" class="sizeby btn btn-outline-primary">Mass</button>
            </div>
            <div id="toggles"></div>
        </div>
        <svg id="canvas"></svg>
        <script>
            const svg = d3.select('#canvas')
            // percentage of the total to be used for empty space between bodies
            const spacerPercent = .2
            // margin and canvas init
            const margin = {
                top: 10,
                right: 10,
                bottom: 10,
                left: 10
            }

            // resizes bodies, sets styles on buttons
            const onSizeByChange = (value) => {
                setSizeBy(value)
                d3.selectAll('.sizeby')
                    .classed('btn-primary', false)
                    .classed('btn-outline-primary', true)
                d3.select(`#${value}`)
                    .classed('btn-outline-primary', false)
                    .classed('btn-primary', true)
            }
            
            // adds/removes a body, sets styles on buttons
            const onBodyToggle = (index) => {
                const toggled = toggleBody(index)
                toggled
                    .classed('btn-primary', dataset[index].enabled)
                    .classed('btn-outline-primary', !dataset[index].enabled)
            }

            getUrlParameter = name => {
                name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                var results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            }

            let dataset = real_data
            const dataParam = getUrlParameter('data')
            switch (dataParam) {
                case 'ksp': dataset = kerbal_data; break
                case 'moons': dataset = moon_data; break
            }

            // on window load, create toggle buttons and draw canvas
            d3.select(window).on('load', () => {
                createToggleButtons(d3.select('#toggles'), 'onBodyToggle')
                window.onresize = () => draw()
                draw()
            })
        </script>
    </body>
</html>

<!DOCTYPE html>
<html>
    <head>
        <title>Space Scales</title>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <select id="sizeBy" onchange="setSizeBy(this.options[this.selectedIndex].value)">
                <option value="radius">radius</option>
                <option value="density">density</option>
            </select>
        <svg id="canvas"></svg>
    </head>
    <body>
        <script>
            // colors
            const background = '#EADBC4'
            // percentage of the total to be used for empty space between bodies
            const spacerPercent = .2
            // margin and canvas init
            const margin = {
                top: 10,
                right: 10,
                bottom: 10,
                left: 10
            }
            // additional padding on svg since using straight window size causes scrollbars
            // also useful if needing to add other stuff to the window (buttons, etc)
            const bottomPadding = 40
            const rightPadding = 16
            // the attribute that we will size bodies by
            let sizeBy = 'radius'

            // radius in km, density in g/cm^3
            let dataset = [
                { name: 'Sol', radius: 696000, color: 'white', density: 1.41 },
                { name: 'Mercury', radius: 2439, color: 'gray', density: 5.4 },
                { name: 'Venus', radius: 6051, color: 'lightyellow', density: 5.2 },
                { name: 'Earth', radius: 6378, color: 'lightblue', density: 5.5 },
                { name: 'Mars', radius: 3389, color: 'maroon', density: 3.9 },
                { name: 'Jupiter', radius: 69911, color: 'orange', density: 1.3 },
                { name: 'Saturn', radius: 58232, color: 'gold', density: .7 },
                { name: 'Uranus', radius: 25361, color: 'lightblue', density: 1.3 },
                { name: 'Neptune', radius: 24621, color: 'lightblue', density: 1.6 },
                { name: 'Pluto', radius: 1184, color: 'lightbrown', density: 1.88 }
            ]

            const svg = d3.select('#canvas')
            let width, height, g, xMax, spacer
            svg.style('background-color', background)

            const _clear = () => {
                svg.selectAll('*').remove()
            }

            const setSizeBy = value => {
                sizeBy = value
                draw(dataset, true)
            }

            // math to give bodies x-positions and add space between them
            const calcXpos = data => {
                const totalRadius = data.reduce((sum, d) => sum + d[sizeBy] * 2, 0)
                xMax = totalRadius / (1 - spacerPercent)
                const spacerTotal = xMax * spacerPercent
                spacer = spacerTotal / (data.length + 1)
            }

            const draw = (data, isTransition = false) => {
                if (!isTransition) {
                    _clear()
                    // sets svg dimensions
                    width = window.innerWidth - margin.left - margin.right - rightPadding
                    height = window.innerHeight - margin.top - margin.bottom - bottomPadding
                    svg.attr('width', width + margin.left + margin.right)
                        .attr('height', height + margin.top + margin.bottom)
                    g = svg.append('g').attr('transform', `translate(${margin.left}, ${margin.top})`)
                }
                
                calcXpos(data)

                let startPosition = spacer
                data = data.map(d => {
                    d.xPos = startPosition + d[sizeBy]
                    startPosition += d[sizeBy] * 2 + spacer
                    return d
                })

                const xScale = d3.scaleLinear().domain([0, xMax]).range([0, width])

                let selection = g.selectAll('circle').data(data)
                if (isTransition) { selection = selection.transition().duration(7000) }
                else { selection = selection.enter().append('circle') }

                selection
                    .attr('cx', d => xScale(d.xPos))
                    .attr('cy', height / 2)
                    .attr('r', d => xScale(d[sizeBy]))
                    .attr('fill', d => d.color)
                    .attr('stroke-width', 2)
                    .attr('stroke', 'black')
            }

            draw(dataset)
            window.onresize = () => draw(dataset)
        </script>
    </body>
</html>
